{% extends 'bootstrap/base.html' %}
{% block title %}YouDoIt{% endblock %}
{% block content %}
<div id="loopvids">
    <table class="table table-dark table-bordered">
        <thead>
        <tr>
            <th scope="col">#</th>
            <th style="width: 75%" scope="col" align="center">Loop Video</th>
            <th scope="col" align="center">Download Audio</th>
            <th scope="col" align="center">Download Video</th>
        </tr>
        </thead>
        <tbody>
        {% for result in yplayers['res'] %}
        <tr>
            <th scope="row">{{ result['id'] }}</th>
            <td style="width: 75%">
                <div class="embed-responsive embed-responsive-16by9">
                    <div id="{{ result['pid'] }}">
                    </div>
                </div>
            </td>
            <td align="center"></td>
            <td align="center">Download link</td>
        </tr>
        {% endfor %}
        </tbody>
    </table>
</div>
{% endblock %}

{% block scripts %}
{{ super() }}
<script src="https://www.youtube.com/iframe_api"></script>
<script type="text/javascript">
  var playerInfoList = {{ yplayers['res']|tojson }}
  function onYouTubeIframeAPIReady() {
      if(typeof playerInfoList === 'undefined')
          return;

      for(var i = 0; i < playerInfoList.length; i++) {
          var curplayer = createPlayer(playerInfoList[i]);
      }
  }
  function onPlayerStateChange(event) {
      if(event.data == YT.PlayerState.ENDED) {
          event.target.seekTo(0);
          event.target.playVideo();
    }
  }
  function createPlayer(playerInfo) {
      return new YT.Player(playerInfo.pid, {
          videoId: playerInfo.vid,
          events: {
        'onStateChange': onPlayerStateChange
        }});
  }
</script>
{% endblock %}
